
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>crawler.registry &#8212; PDSSP Crawler</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/pdssp_logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../api_docs/index.html">
   Crawler Python APIs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../api_docs/crawler/index.html">
     Crawler API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../crawler_cli.html">
   Crawler CLI
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1>Source code for crawler.registry</h1><div class="highlight"><pre>
<span></span>&quot;&quot;&quot;PDSSP Crawler registry module.&quot;&quot;&quot;
from typing import Optional
from pydantic import BaseModel
import yaml
from pathlib import Path

# Registry Models

<div class="viewcode-block" id="ServiceDefinition"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.ServiceDefinition">[docs]</a>class ServiceDefinition(BaseModel):
    type: str
    url: str
    params: dict</div>


<div class="viewcode-block" id="SourceDefinition"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.SourceDefinition">[docs]</a>class SourceDefinition(BaseModel):
    service: ServiceDefinition
    metadata_schema: str
    file_format: str</div>


<div class="viewcode-block" id="CollectionDefinition"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.CollectionDefinition">[docs]</a>class CollectionDefinition(BaseModel):
    id: str
    title: str
    description: str
    extensions: list[str]  # eg: [&#39;ssys&#39;, &#39;proj&#39;]
    source: SourceDefinition
    path: str</div>

<div class="viewcode-block" id="CatalogDefinition"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.CatalogDefinition">[docs]</a>class CatalogDefinition(BaseModel):
    id: str
    title: str
    description: str
    extensions: list[str]

    catalogs: list[str]
    &quot;&quot;&quot;List of catalog ids.&quot;&quot;&quot;

    collections: list[str]
    &quot;&quot;&quot;List of collection ids.&quot;&quot;&quot;

    path: str
    &quot;&quot;&quot;Catalog path relative to root catalog.&quot;&quot;&quot;</div>


<div class="viewcode-block" id="AbstractRegistry"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.AbstractRegistry">[docs]</a>class AbstractRegistry:
    &quot;&quot;&quot;AbstractRegistry class defining an common interface/methods for any types of registry.
    &quot;&quot;&quot;
    def __init__(self, path=&#39;&#39;):
        # assign registry interface type
        self.type = &#39;&#39;
        for type in REGISTRY_TYPES.keys():
            if self.__class__.__name__ == REGISTRY_TYPES[type].__name__:
                self.type = type
        # set path
        self.path = path

    def __repr__(self):
        return (
            f&quot;&lt;{self.__class__.__name__}&gt; &quot;
            f&quot;Type: {self.type} | &quot;
            f&quot;Path: {self.path}&quot;
        )

<div class="viewcode-block" id="AbstractRegistry.get_collections_ids"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.AbstractRegistry.get_collections_ids">[docs]</a>    def get_collections_ids(self, id=&#39;&#39;, path=&#39;&#39;) -&gt; list[str]:
        return []</div>

<div class="viewcode-block" id="AbstractRegistry.get_collections"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.AbstractRegistry.get_collections">[docs]</a>    def get_collections(self, id=&#39;&#39;, path=&#39;&#39;) -&gt; list[CollectionDefinition]:
        return []</div>

<div class="viewcode-block" id="AbstractRegistry.get_collection"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.AbstractRegistry.get_collection">[docs]</a>    def get_collection(self, id) -&gt; CollectionDefinition:
        return None</div>

<div class="viewcode-block" id="AbstractRegistry.get_catalog_ids"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.AbstractRegistry.get_catalog_ids">[docs]</a>    def get_catalog_ids(self) -&gt; list[str]:
        return []</div>

<div class="viewcode-block" id="AbstractRegistry.get_catalogs"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.AbstractRegistry.get_catalogs">[docs]</a>    def get_catalogs(self, id) -&gt; list[CatalogDefinition]:
        return None</div>

<div class="viewcode-block" id="AbstractRegistry.get_catalog"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.AbstractRegistry.get_catalog">[docs]</a>    def get_catalog(self, id, path=&#39;&#39;) -&gt; CatalogDefinition:
        return None</div></div>

<div class="viewcode-block" id="Registry"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.Registry">[docs]</a>def Registry(type: str, path=&#39;&#39;) -&gt; AbstractRegistry:
    &quot;&quot;&quot;Function serving as Registry objects factory.

    Example:
        registry = Registry(&#39;YAML&#39;, path=&#39;/path/to/stac_catalog/model/catalog.yaml&#39;)
    &quot;&quot;&quot;
    if type in REGISTRY_TYPES.keys():
        RegistryClass = REGISTRY_TYPES[type]
        registry = RegistryClass(path=path)
        return registry
    else:
        print(f&#39;Unknown registry type: {type}.&#39;)
        return None</div>

    #
    # def __init__(self, parameters, geoevt=None, silent=None):
    #     super().__init__(parameters, geoevt=geoevt, silent=silent)
    #

<div class="viewcode-block" id="YAMLInvalidDefinition"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLInvalidDefinition">[docs]</a>class YAMLInvalidDefinition(Exception):
    &quot;&quot;&quot;Invalid YAML Registry definition.&quot;&quot;&quot;</div>

<div class="viewcode-block" id="YAMLRegistry"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry">[docs]</a>class YAMLRegistry(AbstractRegistry):
    &quot;&quot;&quot;YAMLRegistry class
    &quot;&quot;&quot;
    def __init__(self, path=&#39;&#39;):
        super().__init__(path=path)
        self.catalogs = [] # : list[CatalogDefinition]
        self.collections = [] #: list[CollectionDefinition]
        self.services = []  # : list[ServiceDefinition]

        # TODO: check that registry YAML file exists

        # parse YAML registry (root) catalog file
        yaml_catalog_dict = self.parse_yaml_catalog_file(self.path)
        self.add_catalog(yaml_catalog_dict, &#39;.&#39;)
        self.catalogs.reverse()
        self.collections.reverse()

<div class="viewcode-block" id="YAMLRegistry.add_catalog"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.add_catalog">[docs]</a>    def add_catalog(self, yaml_catalog_dict, relpath):
        #print(f&#39;catalog_relpath = {relpath}&#39;)
        # raise exception if required YAML `catalog` attributes are missing
        for yaml_attr in [&#39;id&#39;, &#39;title&#39;, &#39;description&#39;]:
            if yaml_attr not in yaml_catalog_dict.keys():
                raise Exception(f&#39;Missing YAML catalog `{yaml_attr}` attribute: {yaml_catalog_dict}&#39;)

        # set default YAML `extensions` attribute value to empty list if missing
        extensions = []
        if &#39;extensions&#39; in yaml_catalog_dict.keys():
            extensions = yaml_catalog_dict[&#39;extensions&#39;]

        # set default YAML `catalogs` attribute value to empty list if missing
        catalogs_relpaths = []
        catalogs_ids = []
        if &#39;catalogs&#39; in yaml_catalog_dict.keys():
            catalogs_relpaths = yaml_catalog_dict[&#39;catalogs&#39;]
            for catalogs_relpath in catalogs_relpaths:
                catalog_relpath = Path(relpath, catalogs_relpath)
                abspath = str(Path(Path(self.path).parent, catalog_relpath))
                catalog_dict = self.parse_yaml_catalog_file(abspath)
                self.add_catalog(catalog_dict, str(catalog_relpath.parent))
                if self.last_added_catalog_id():
                    catalogs_ids.append(self.last_added_catalog_id())
                else:
                    raise YAMLInvalidDefinition(&#39;Invalid YAML collection catalog: {catalog_dict}&#39;)

        # set default YAML `collections` attribute value to empty list if missing
        collections_relpaths = []
        collections_ids = []
        if &#39;collections&#39; in yaml_catalog_dict:
            collections_relpaths = yaml_catalog_dict[&#39;collections&#39;]
            for collections_relpath in collections_relpaths:
                collections_relpath = Path(relpath, collections_relpath)
                abspath = str(Path(Path(self.path).parent, collections_relpath))
                yaml_collection_dict = self.parse_yaml_collection_file(abspath)
                self.add_collection(yaml_collection_dict, str(collections_relpath.parent))
                if self.last_added_collection_id():
                    collections_ids.append(self.last_added_collection_id())
                else:
                    raise YAMLInvalidDefinition(&#39;Invalid YAML collection definition: {collection_dict}&#39;)

        # create and add catalog
        catalog = CatalogDefinition(
            id=yaml_catalog_dict[&#39;id&#39;],
            title=yaml_catalog_dict[&#39;title&#39;],
            description=yaml_catalog_dict[&#39;description&#39;],
            extensions=extensions,
            catalogs=catalogs_ids,
            collections=collections_ids,
            path=relpath
        )
        self.catalogs.append(catalog)</div>

<div class="viewcode-block" id="YAMLRegistry.add_collection"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.add_collection">[docs]</a>    def add_collection(self, yaml_collection_dict, relpath):
        #print(f&#39;collection_relpath = {relpath}&#39;)
        # raise exception if required YAML `collection` attributes are missing
        for yaml_attr in [&#39;id&#39;, &#39;title&#39;, &#39;description&#39;, &#39;source&#39;]:
            if yaml_attr not in yaml_collection_dict.keys():
                raise Exception(f&#39;Missing YAML collection `{yaml_attr}` attribute in: {yaml_collection_dict}&#39;)

        # set default YAML `extensions` attribute value to empty list if missing
        extensions = []
        if &#39;extensions&#39; in yaml_collection_dict.keys():
            extensions = yaml_collection_dict[&#39;extensions&#39;]

        yaml_source_dict = yaml_collection_dict[&#39;source&#39;]
        service = ServiceDefinition(**yaml_source_dict[&#39;service&#39;])
        self.add_service(service)

        metadata_schema = &#39;&#39;
        if &#39;metadata_schema&#39; in yaml_source_dict.keys():
            metadata_schema = yaml_source_dict[&#39;metadata_schema&#39;]

        file_format = &#39;&#39;
        if &#39;file_format&#39; in yaml_source_dict.keys():
            file_format = yaml_source_dict[&#39;file_format&#39;]

        source = SourceDefinition(service=service, metadata_schema=metadata_schema, file_format=file_format)

        # create and add catalog to registry
        collection = CollectionDefinition(
            id=yaml_collection_dict[&#39;id&#39;],
            title=yaml_collection_dict[&#39;title&#39;],
            description=yaml_collection_dict[&#39;description&#39;],
            extensions=extensions,
            source=source,
            path=relpath
        )
        self.collections.append(collection)</div>


<div class="viewcode-block" id="YAMLRegistry.add_service"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.add_service">[docs]</a>    def add_service(self, service: ServiceDefinition):
        self.services.append(service)</div>

<div class="viewcode-block" id="YAMLRegistry.parse_yaml_catalog_file"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.parse_yaml_catalog_file">[docs]</a>    def parse_yaml_catalog_file(self, yaml_catalog_relpath):
        with open(yaml_catalog_relpath, mode=&#39;r&#39;) as file:
            yaml_catalog_dict = (yaml.safe_load(file))
        catalog_dict = {}
        if &#39;catalog&#39; in yaml_catalog_dict.keys():
            catalog_dict = yaml_catalog_dict[&#39;catalog&#39;]
        return catalog_dict</div>

<div class="viewcode-block" id="YAMLRegistry.parse_yaml_collection_file"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.parse_yaml_collection_file">[docs]</a>    def parse_yaml_collection_file(self, yaml_collection_relpath):
        with open(yaml_collection_relpath, mode=&#39;r&#39;) as file:
            yaml_collection_dict = (yaml.safe_load(file))
        collection_dict = {}
        if &#39;collection&#39; in yaml_collection_dict.keys():
            collection_dict = yaml_collection_dict[&#39;collection&#39;]
        return collection_dict</div>

<div class="viewcode-block" id="YAMLRegistry.last_added_catalog_id"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.last_added_catalog_id">[docs]</a>    def last_added_catalog_id(self):
        return self.catalogs[-1].id</div>

<div class="viewcode-block" id="YAMLRegistry.last_added_collection_id"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.last_added_collection_id">[docs]</a>    def last_added_collection_id(self):
        return self.collections[-1].id</div>

<div class="viewcode-block" id="YAMLRegistry.get_collections_ids"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.get_collections_ids">[docs]</a>    def get_collections_ids(self, id=&#39;&#39;, path=&#39;&#39;) -&gt; list[str]:
        collections_ids = []
        for collection in self.collections:
            if (id in collection.id) and (path in collection.path):
                collections_ids.append(collection.id)
        return collections_ids</div>

<div class="viewcode-block" id="YAMLRegistry.get_collections"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.get_collections">[docs]</a>    def get_collections(self, id=&#39;&#39;, path=&#39;&#39;) -&gt; list[CollectionDefinition]:
        matching_collections = []
        for collection in self.collections:
            if (id in collection.id) and (path in collection.path):
                matching_collections.append(collection)
        return matching_collections</div>

<div class="viewcode-block" id="YAMLRegistry.get_collection"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.get_collection">[docs]</a>    def get_collection(self, id) -&gt; Optional[CollectionDefinition]:
        for collection in self.collections:
            if collection.id == id:
                return collection
        return None</div>

<div class="viewcode-block" id="YAMLRegistry.get_catalogs_ids"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.get_catalogs_ids">[docs]</a>    def get_catalogs_ids(self, id=&#39;&#39;, path=&#39;&#39;) -&gt; list[str]:
        catalogs_ids = []
        for catalog in self.catalogs:
            if (id in catalog.id) and (path in catalog.path):
                catalogs_ids.append(catalog.id)
        return catalogs_ids</div>

<div class="viewcode-block" id="YAMLRegistry.get_catalogs"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.get_catalogs">[docs]</a>    def get_catalogs(self, id=&#39;&#39;, path=&#39;&#39;) -&gt; list[CatalogDefinition]:
        matching_catalogs = []
        for catalog in self.catalogs:
            if (id in catalog.id) and (path in catalog.path):
                matching_catalogs.append(catalog)
        return matching_catalogs</div>

<div class="viewcode-block" id="YAMLRegistry.get_catalog"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.YAMLRegistry.get_catalog">[docs]</a>    def get_catalog(self, id) -&gt; Optional[CatalogDefinition]:
        for catalog in self.catalogs:
            if catalog.id == id:
                return catalog
        return None</div></div>

<div class="viewcode-block" id="RESTOAPIRegistry"><a class="viewcode-back" href="../../api_docs/crawler/index.html#crawler.registry.RESTOAPIRegistry">[docs]</a>class RESTOAPIRegistry(AbstractRegistry):
    &quot;&quot;&quot;RESTOAPIRegistry class.
    &quot;&quot;&quot;
    def __init__(self, definition):
        print(&#39;Not implemented yet.&#39;)</div>


REGISTRY_TYPES = {
    &#39;YAML&#39;: YAMLRegistry,
    &#39;RESTO_REGISTRY_API&#39;: RESTOAPIRegistry  # doesn&#39;t exists yet
}
</pre></div>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Nicolas Manaud<br/>
  
      &copy; Copyright .<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>